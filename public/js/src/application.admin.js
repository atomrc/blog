define(["angular","extensions","application"],function(t,e,n){return n.directives.autocomplete=["$http",function(t){return{restrict:"A",template:'<input type="text" data-ng-model="term"><div class="autocomplete-results"><div data-ng-repeat="result in results" data-ng-bind="result.name" data-ng-click="selectResult(result);"></div></div>',scope:{term:"=autocomplete",url:"@autocompleteUrl",select:"&autocompleteSelect"},link:function(e){e.selectResult=function(t){e.select({data:t})},e.$watch("term",function(n){n&&(e.results=[],n.length>2&&t.get(e.url,{params:{term:n}}).then(function(t){e.results=t.data}))})}}}],n.directives.contenteditable=["$window",function(t){return{require:"ngModel",link:function(e,n,o,a){var u=function(t,e){switch(t){case 80:document.execCommand("formatBlock",!1,"p");break;case 66:document.execCommand("bold");break;case 97:document.execCommand("formatBlock",!1,"h1");break;case 98:document.execCommand("formatBlock",!1,"h2");break;case 99:document.execCommand("formatBlock",!1,"h3");break;case 85:document.execCommand("insertUnorderedList");break;case 65:e&&e.match(/http:\/\/[A-Za-z0-9.\/-_]+/)&&document.execCommand("createLink",!1,e)}};n.bind("blur",function(){e.$apply(function(){e.$emit("updateModel")})}),e.$on("updateModel",function(){a.$setViewValue(n.html())}),a.$render=function(){n.html(this.$modelValue)},n.bind("keyup",function(t){t.ctrlKey||e.$emit("updateModel")}),n.bind("keydown",function(e){e.ctrlKey&&(u(e.keyCode,t.getSelection().toString()),e.preventDefault())})}}}],n.directives.postEdition=["$document",function(){return{restrict:"A",scope:{post:"=postEdition"},controller:"postEditionController"}}],n.services.adminPostsManager=["postsManager","Tag","Post",function(t,e){return t.create=function(t){return t.$save().then(function(){this.posts.unshift(t)}.bind(this))},t.save=function(t){var e=this;return t.id?t.$update():t.$save().then(function(t){e.posts.unshift(t)})},t.remove=function(t){var e=this;t.$delete().then(function(){e.posts.removeElement(t)})},t.reset=function(t){return t.pubdate=null,t.slug=null,t.$update()},t.toggleState=function(t){return t.status=(t.status+1)%3,t.$update()},t.tag=function(t,n){var o=function(t,e){t.$tag({resourceId:e.id})};return n.id?(o(t,n),void 0):(n=new e(n),n.$save().then(function(e){o(t,e)}))},t.untag=function(t,e){t.$untag({resourceId:e.id})},t}],n.controllers.postEditionController=["$scope","adminPostsManager","Post","$location","$window",function(t,e,n,o,a){t.add=function(){t.newPost=new n},t.$watch("post",function(t,e){t&&e&&(t.$unsaved=!0)},!0),t.keydown=function(e){e.ctrlKey&&83===e.keyCode&&(t.$emit("updateModel"),t.save())},t.create=function(n){e.create(n),t.newPost=null},t.toggleState=e.toggleState,t.save=function(){var n=t.post;e.save(n).then(function(){o.url("/posts/"+n.slug)})},t.reset=function(t){a.confirm("It might probably change the url of the post. Are you sure you want to do that ?")&&e.reset(t).then(function(){o.url("/posts/"+t.slug)})},t.remove=function(t){a.confirm("sure bro ?")&&e.remove(t)}}],n.controllers.tagsController=["$scope","Tag","adminPostsManager",function(t,e,n){t.create=function(){t.newTag=new e},t.tag=function(e,o){n.tag(e,o),t.newTag=null},t.remove=function(t,e){n.untag(t,e)}}],n});